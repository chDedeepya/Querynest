<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Querynest0.1</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.10.4/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

    :root {
      --primary: #3B82F6;
      --primary-dark: #1E40AF;
      --secondary: #10B981;
      --background: #F9FAFB;
      --card-bg: #FFFFFF;
      --text: #111827;
      --text-secondary: #6B7280;
      --border: #E5E7EB;
      --error: #EF4444;
      --success: #22C55E;
      --warning: #F59E0B;
    }

    [data-theme="dark"] {
      --primary: #60A5FA;
      --primary-dark: #2563EB;
      --secondary: #34D399;
      --background: #111827;
      --card-bg: #1F2937;
      --text: #F9FAFB;
      --text-secondary: #9CA3AF;
      --border: #374151;
      --error: #F87171;
      --success: #4ADE80;
      --warning: #FBBF24;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--background);
      color: var(--text);
      transition: background-color 0.3s, color 0.3s;
    }

    .header {
      background: var(--card-bg);
      border-bottom: 1px solid var(--border);
      padding: 1rem;
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .sidebar {
      background: var(--card-bg);
      border-right: 1px solid var(--border);
      transition: transform 0.3s ease-in-out;
    }

    .sidebar-hidden {
      transform: translateX(-100%);
    }

    .sidebar a {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      color: var(--text-secondary);
      transition: all 0.2s;
    }

    .sidebar a:hover, .sidebar a.active {
      background: var(--primary);
      color: #FFFFFF;
      transform: translateX(4px);
    }

    .sidebar a i {
      font-size: 1.25rem;
    }

    .page {
      min-height: calc(100vh - 4rem);
      padding: 1.5rem;
      position: relative;
      overflow: hidden;
    }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 0.75rem;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    }

    .page-title {
      font-size: 1.875rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .divider {
      height: 2px;
      background: var(--border);
      margin: 1.5rem 0;
    }

    .table-container {
      max-height: 400px;
      overflow-y: auto;
      border-radius: 0.5rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    table th, table td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    table th {
      background: var(--primary);
      color: #FFFFFF;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    table tr:hover {
      background: var(--background);
    }

    input, textarea, select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      background: var(--card-bg);
      color: var(--text);
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .input-label {
      position: absolute;
      top: 0.75rem;
      left: 1rem;
      color: var(--text-secondary);
      transition: all 0.2s;
      pointer-events: none;
    }

    input:not(:placeholder-shown) + .input-label,
    input:focus + .input-label,
    textarea:not(:placeholder-shown) + .input-label,
    textarea:focus + .input-label {
      top: -0.5rem;
      left: 0.75rem;
      font-size: 0.75rem;
      color: var(--primary);
      background: var(--card-bg);
      padding: 0 0.25rem;
    }

    button {
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--primary);
      color: #FFFFFF;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .btn-secondary {
      background: var(--secondary);
      color: #FFFFFF;
    }

    .btn-secondary:hover {
      background: #059669;
      transform: translateY(-2px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .btn-danger {
      background: var(--error);
      color: #FFFFFF;
    }

    .btn-danger:hover {
      background: #DC2626;
      transform: translateY(-2px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .notification-bell {
      position: relative;
      cursor: pointer;
    }

    .notification-bell .badge {
      position: absolute;
      top: -6px;
      right: -6px;
      background: var(--error);
      color: #FFFFFF;
      border-radius: 50%;
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
    }

     .login-page {
      background: linear-gradient(45deg, #1e3a8a, #2563eb, #60a5fa);
      background-size: 200% 200%;
      animation: gradientShift 15s ease infinite;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      position: relative;
      overflow: hidden;
    }

    .login-page::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"%3E%3Cpath fill="rgba(255,255,255,0.1)" fill-opacity="1" d="M0,128L48,138.7C96,149,192,171,288,181.3C384,192,480,192,576,181.3C672,171,768,149,864,154.7C960,160,1056,192,1152,197.3C1248,203,1344,181,1392,170.7L1440,160L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"%3E%3C/path%3E%3C/svg%3E') bottom;
      z-index: 0;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 0.5; }
      50% { transform: scale(1.2); opacity: 0.3; }
      100% { transform: scale(1); opacity: 0.5; }
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .login-card {

      border: 1px solid rgba(0, 0, 0, 0.3);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      border-radius: 2.5rem;
      position: relative;
      overflow: hidden;
    }

    .login-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
    }
    

    .faq-item {
      border-bottom: 1px solid var(--border);
      padding: 1rem 0;
    }

    .faq-question {
      cursor: pointer;
      font-weight: 500;
      transition: color 0.2s;
    }

    .faq-question:hover {
      color: var(--primary);
    }

    .faq-answer {
      display: none;
      margin-top: 0.5rem;
      color: var(--text-secondary);
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @media (max-width: 640px) {
      .page-title {
        font-size: 1.5rem;
      }
      .card {
        padding: 1rem;
      }
      .table-container table {
        min-width: 600px;
      }
      .sidebar {
        width: 80%;
      }
    }
  </style>
</head>
<body data-theme="light">
  <!-- Unified Header -->
  <div class="header" id="header">
    <div class="max-w-7xl mx-auto px-4 flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTReYn9af4RasjHQ75t7LZjbMVn_xVohEMdSQ&s" alt="Logo" class="w-10" />
        <h1 class="text-xl font-bold">Querynest</h1>
      </div>
      <div class="flex items-center gap-3">
        <button onclick="showPage('dashboardPage')" class="btn-primary">Home</button>
        <button onclick="logout()" class="btn-danger">Logout</button>
      </div>
    </div>
  </div>

  <!-- Sidebar Navigation -->
  <div class="fixed inset-y-0 left-0 w-64 sidebar z-40 transform lg:transform-none hidden" id="sidebar">
    <div class="p-4 flex items-center gap-3 border-b border-[var(--border)]">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTReYn9af4RasjHQ75t7LZjbMVn_xVohEMdSQ&s" alt="Logo" class="w-10" />
      <h1 class="text-lg font-bold">Querynest</h1>
    </div>
    <nav class="p-4 space-y-2">
      <a href="#" onclick="showPage('dashboardPage')" class="active"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
      <a href="#" onclick="showPage('complaintSubmissionPage')"><i class="fas fa-exclamation-circle"></i> Submit Complaint</a>
      <a href="#" onclick="showPage('complaintTrackingPage')"><i class="fas fa-search"></i> Track Complaints</a>
      <a href="#" onclick="showPage('adminPage')"><i class="fas fa-user-shield"></i> Admin Panel</a>
      <a href="#" onclick="showPage('userProfilePage')"><i class="fas fa-user"></i> User Profile</a>
      <a href="#" onclick="showPage('feedbackPage')"><i class="fas fa-comment"></i> Feedback</a>
      <a href="#" onclick="showPage('faqPage')"><i class="fas fa-question-circle"></i> FAQ</a>
      <div class="flex items-center gap-2 p-2">
        <div class="notification-bell" onclick="showNotifications()">
          <i class="fas fa-bell"></i>
          <span class="badge" id="notificationCount">0</span>
        </div>
      </div>
      <button id="themeToggle" class="flex items-center gap-2 p-2 w-full text-left">
        <i class="fas fa-moon"></i> Dark Mode
      </button>
    </nav>
  </div>

  <!-- Mobile Menu Toggle -->
  <div class="lg:hidden fixed top-4 left-4 z-50 hidden" id="menuToggleContainer">
    <button id="menuToggle" class="p-2 bg-[var(--primary)] text-white rounded-lg">
      <i class="fas fa-bars"></i>
    </button>
  </div>

  <!-- Main Content -->
  <div class="lg:ml-64" id="mainContent">
    <!-- Login Page (Unchanged) -->
    <div id="loginPage" class="login-page">
      <div class="login-card max-w-lg sm:max-w-2xl mx-auto p-8 sm:p-12 rounded-2xl">
        <div class="flex justify-center mb-4 sm:mb-6">
          <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTReYn9af4RasjHQ75t7LZjbMVn_xVohEMdSQ&s" alt="Logo" class="login-logo" />
        </div>
        <h2 class="page-title"><i class="fas fa-sign-in-alt mr-2"></i> Welcome to Querynest</h2>
        <p class="text-center text-gray-600 mb-4 sm:mb-6 text-sm sm:text-base">Sign in to manage your complaints</p>
        <div class="divider"></div>
        <div class="space-y-4 sm:space-y-6 relative z-10">
          <div class="relative">
            <select id="user-type" onchange="showLoginFields()" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base">
              <option value="">Select User Type</option>
              <option value="student">Student</option>
              <option value="faculty">Faculty</option>
              <option value="admin">Admin</option>
            </select>
          </div>
          <div id="student-fields" class="hidden space-y-4">
            <div class="relative">
              <input type="text" id="student-username" placeholder=" " class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base" />
              <label for="student-username" class="input-label">Username</label>
            </div>
            <div class="relative">
              <input type="password" id="student-password" placeholder=" " class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base" />
              <label for="student-password" class="input-label">Password</label>
            </div>
            <div class="relative">
              <input type="email" id="student-email" placeholder=" " class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base" />
              <label for="student-email" class="input-label">Email</label>
            </div>
            <div class="relative">
              <input type="text" id="student-regid" placeholder=" " class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base" />
              <label for="student-regid" class="input-label">Registration ID</label>
            </div>
          </div>
          <div id="faculty-fields" class="hidden space-y-4">
            <div class="relative">
              <input type="text" id="faculty-id" placeholder=" " class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base" />
              <label for="faculty-id" class="input-label">ID</label>
            </div>
            <div class="relative">
              <input type="password" id="faculty-password" placeholder=" " class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base" />
              <label for="faculty-password" class="input-label">Password</label>
            </div>
            <div class="relative">
              <input type="text" id="faculty-grid" placeholder=" " class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base" />
              <label for="faculty-grid" class="input-label">Grid Values</label>
            </div>
          </div>
          <div id="admin-fields" class="hidden space-y-4">
            <div class="relative">
              <input type="text" id="admin-id" placeholder=" " class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base" />
              <label for="admin-id" class="input-label">ID</label>
            </div>
            <div class="relative">
              <input type="password" id="admin-password" placeholder=" " class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base" />
              <label for="admin-password" class="input-label">Password</label>
            </div>
            <div class="relative">
              <input type="text" id="admin-grid" placeholder=" " class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm sm:text-base" />
              <label for="admin-grid" class="input-label">Grid Values</label>
            </div>
          </div>
          <button onclick="login()" class="login-button w-full text-white rounded-lg font-semibold">Login</button>
          <div id="login-error" class="error-message">Invalid credentials. Please check your inputs.</div>
        </div>
      </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboardPage" class="page" style="display: none;">
      <div class="max-w-7xl mx-auto">
        <h2 class="page-title"><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
        <div class="divider"></div>
        <div id="dashboardContent" class="grid gap-6"></div>
      </div>
    </div>

    <!-- Complaint Submission Page -->
    <div id="complaintSubmissionPage" class="page" style="display: none;">
      <div class="card max-w-lg mx-auto">
        <h2 class="page-title"><i class="fas fa-exclamation-circle"></i> Submit Complaint</h2>
        <div class="divider"></div>
        <form class="space-y-6">
          <div class="relative">
            <input type="text" id="complaint-name" placeholder=" " required />
            <label for="complaint-name" class="input-label">Your Name</label>
          </div>
          <div class="relative">
            <input type="email" id="complaint-email" placeholder=" " required />
            <label for="complaint-email" class="input-label">Your Email</label>
          </div>
          <div class="relative">
            <textarea id="complaint-description" rows="5" placeholder=" " required></textarea>
            <label for="complaint-description" class="input-label">Describe Your Complaint</label>
          </div>
          <div class="relative">
            <input type="text" id="complaint-category" placeholder=" " required />
            <label for="complaint-category" class="input-label">Category (e.g., Technical, Administrative)</label>
          </div>
          <button type="button" onclick="submitComplaint()" class="btn-primary w-full">Submit Complaint</button>
        </form>
      </div>
    </div>

    <!-- Complaint Tracking Page -->
    <div id="complaintTrackingPage" class="page" style="display: none;">
      <div class="card max-w-7xl mx-auto">
        <h2 class="page-title"><i class="fas fa-search"></i> Complaint Tracking</h2>
        <div class="divider"></div>
        <div class="flex flex-col sm:flex-row gap-4 mb-6">
          <input type="text" id="searchInput" placeholder="Search complaints..." onkeyup="searchComplaints()" />
          <select id="status-filter" onchange="filterComplaints()">
            <option value="all">All</option>
            <option value="pending">Pending</option>
            <option value="in-progress">In Progress</option>
            <option value="resolved">Resolved</option>
          </select>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Complaint ID</th>
                <th>Category</th>
                <th>Description</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="complaintTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPage" class="page" style="display: none;">
      <div class="card max-w-7xl mx-auto">
        <h2 class="page-title"><i class="fas fa-user-shield"></i> Admin Panel</h2>
        <div class="divider"></div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Complaint ID</th>
                <th>Category</th>
                <th>Description</th>
                <th>Status</th>
                <th>Assign To</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="adminComplaintTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- User Profile Page -->
    <div id="userProfilePage" class="page" style="display: none;">
      <div class="card max-w-lg mx-auto">
        <h2 class="page-title"><i class="fas fa-user"></i> User Profile</h2>
        <div class="divider"></div>
        <div class="space-y-6">
          <div class="relative">
            <input type="text" id="profile-name" placeholder=" " value="John Doe" />
            <label for="profile-name" class="input-label">Name</label>
          </div>
          <div class="relative">
            <input type="email" id="profile-email" placeholder=" " value="johndoe@example.com" />
            <label for="profile-email" class="input-label">Email</label>
          </div>
          <div class="relative">
            <select id="profile-role">
              <option value="student">Student</option>
              <option value="faculty">Faculty</option>
              <option value="admin">Admin</option>
            </select>
          </div>
          <button onclick="updateProfile()" class="btn-primary w-full">Update Profile</button>
        </div>
      </div>
    </div>

    <!-- Feedback Page -->
    <div id="feedbackPage" class="page" style="display: none;">
      <div class="card max-w-lg mx-auto">
        <h2 class="page-title"><i class="fas fa-comment"></i> Feedback</h2>
        <div class="divider"></div>
        <div class="space-y-6">
          <div id="resolution-details" class="text-sm"></div>
          <h3 class="text-lg font-semibold">Leave Your Feedback</h3>
          <div class="relative">
            <textarea id="feedback-text" placeholder=" " rows="5"></textarea>
            <label for="feedback-text" class="input-label">Share your experience...</label>
          </div>
          <button onclick="submitFeedback()" class="btn-secondary w-full">Submit Feedback</button>
        </div>
      </div>
    </div>

    <!-- FAQ Page -->
    <div id="faqPage" class="page" style="display: none;">
      <div class="card max-w-3xl mx-auto">
        <h2 class="page-title"><i class="fas fa-question-circle"></i> Frequently Asked Questions</h2>
        <div class="divider"></div>
        <input type="text" id="faq-search" placeholder="Search FAQs..." class="mb-6" oninput="searchFAQs()" />
        <div id="faq-list">
          <div class="faq-item">
            <p class="faq-question" onclick="toggleFAQ(1)">How can I submit a complaint?</p>
            <p class="faq-answer" id="answer-1">You can submit a complaint through the "Submit Complaint" page by filling out the necessary details and selecting the appropriate category.</p>
          </div>
          <div class="faq-item">
            <p class="faq-question" onclick="toggleFAQ(2)">How can I track my complaint?</p>
            <p class="faq-answer" id="answer-2">You can track your complaint status on the "Complaint Tracking" page using your complaint ID.</p>
          </div>
          <div class="faq-item">
            <p class="faq-question" onclick="toggleFAQ(3)">How long does it take to resolve a complaint?</p>
            <p class="faq-answer" id="answer-3">Resolution times vary based on the nature of the complaint. Typically, most complaints are addressed within 3-5 business days.</p>
          </div>
        </div>
        <div class="text-center mt-6">
          <h3 class="text-lg font-semibold">Need More Help?</h3>
          <p>Contact our support team at <a href="mailto:support@querynest.com" class="text-[var(--primary)] hover:underline">support@querynest.com</a> or call <strong>+1 234 567 890</strong>.</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    let problems = [];
    let currentUserRole = null;
    let currentUser = null;
    let currentFeedbackIndex = null;
    const roleCredentials = {
      student: { username: "student", password: "student123", email: "student@example.com", regid: "STU123" },
      faculty: { id: "FAC123", password: "faculty123", grid: "GRID456" },
      admin: { id: "ADM123", password: "admin123", grid: "GRID789" }
    };

    function loadComplaintsFromStorage() {
      const storedComplaints = localStorage.getItem("complaints");
      if (storedComplaints) problems = JSON.parse(storedComplaints);
    }

    function saveComplaints() {
      localStorage.setItem("complaints", JSON.stringify(problems));
    }

    function hideAllPages() {
      document.querySelectorAll('.page').forEach(page => page.style.display = 'none');
      document.getElementById('loginPage').style.display = 'none';
    }

    function showPage(pageId) {
      hideAllPages();
      document.getElementById(pageId).style.display = 'block';
      const header = document.getElementById('header');
      const sidebar = document.getElementById('sidebar');
      const menuToggleContainer = document.getElementById('menuToggleContainer');

      if (pageId === 'loginPage') {
        header.classList.add('hidden');
        sidebar.classList.add('hidden');
        menuToggleContainer.classList.add('hidden');
        gsap.from('.login-card', { opacity: 0, scale: 0.8, duration: 0.6, ease: 'back.out(1.7)' });
      } else {
        header.classList.remove('hidden');
        sidebar.classList.remove('hidden');
        menuToggleContainer.classList.remove('hidden');
        document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
        document.querySelector(`.sidebar a[onclick="showPage('${pageId}')"]`).classList.add('active');

        if (pageId === 'dashboardPage') loadDashboard();
        else if (pageId === 'complaintTrackingPage') loadComplaints();
        else if (pageId === 'adminPage') {
          if (currentUserRole !== 'admin') {
            alert('Access restricted to admins.');
            showPage('dashboardPage');
            return;
          }
          loadAdminComplaints();
        } else if (pageId === 'userProfilePage') loadUserProfile();
        else if (pageId === 'feedbackPage') loadFeedbackPage();

        gsap.from(`#${pageId} .card`, { opacity: 0, y: 20, duration: 0.5, stagger: 0.1 });
      }
    }

    function showLoginFields() {
      const fields = ['student-fields', 'faculty-fields', 'admin-fields'];
      fields.forEach(field => document.getElementById(field).classList.add('hidden'));
      const userType = document.getElementById('user-type').value;
      if (userType) {
        const field = document.getElementById(`${userType}-fields`);
        field.classList.remove('hidden');
        gsap.from(field.children, { opacity: 0, y: 10, duration: 0.3, stagger: 0.1 });
      }
    }

    function login() {
      let userType = document.getElementById('user-type').value;
      let valid = false;
      const errorMessage = document.getElementById('login-error');

      if (userType === 'student') {
        let username = document.getElementById('student-username').value;
        let password = document.getElementById('student-password').value;
        let email = document.getElementById('student-email').value;
        let regid = document.getElementById('student-regid').value;
        if (
          username === roleCredentials.student.username &&
          password === roleCredentials.student.password &&
          email === roleCredentials.student.email &&
          regid === roleCredentials.student.regid
        ) {
          valid = true;
          currentUser = { username, email, regid };
        }
      } else if (userType === 'faculty') {
        let id = document.getElementById('faculty-id').value;
        let password = document.getElementById('faculty-password').value;
        let grid = document.getElementById('faculty-grid').value;
        if (
          id === roleCredentials.faculty.id &&
          password === roleCredentials.faculty.password &&
          grid === roleCredentials.faculty.grid
        ) {
          valid = true;
          currentUser = { id, grid };
        }
      } else if (userType === 'admin') {
        let id = document.getElementById('admin-id').value;
        let password = document.getElementById('admin-password').value;
        let grid = document.getElementById('admin-grid').value;
        if (
          id === roleCredentials.admin.id &&
          password === roleCredentials.admin.password &&
          grid === roleCredentials.admin.grid
        ) {
          valid = true;
          currentUser = { id, grid };
        }
      }

      if (valid) {
        currentUserRole = userType;
        errorMessage.style.display = 'none';
        showPage('dashboardPage');
      } else {
        errorMessage.style.display = 'block';
        gsap.fromTo(errorMessage, { opacity: 0, y: -10 }, { opacity: 1, y: 0, duration: 0.3 });
        setTimeout(() => {
          gsap.to(errorMessage, { opacity: 0, y: -10, duration: 0.3, onComplete: () => errorMessage.style.display = 'none' });
        }, 3000);
      }
    }

    function logout() {
      currentUserRole = null;
      currentUser = null;
      currentFeedbackIndex = null;
      showPage('loginPage');
    }

    function loadDashboard() {
      const dashboardContent = document.getElementById('dashboardContent');
      if (currentUserRole === 'admin') {
        const totalComplaints = problems.length;
        const pendingComplaints = problems.filter(p => p.status === 'Pending').length;
        const resolvedComplaints = problems.filter(p => p.status === 'Resolved').length;
        dashboardContent.innerHTML = `
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
            <div class="card text-center p-6">
              <i class="fas fa-tachometer-alt text-[var(--primary)] text-2xl mb-2"></i>
              <h3 class="text-lg font-semibold">Total Complaints</h3>
              <p class="text-3xl font-bold text-[var(--primary)] count-up" data-target="${totalComplaints}">0</p>
            </div>
            <div class="card text-center p-6">
              <i class="fas fa-hourglass-half text-[var(--warning)] text-2xl mb-2"></i>
              <h3 class="text-lg font-semibold">Pending</h3>
              <p class="text-3xl font-bold text-[var(--warning)] count-up" data-target="${pendingComplaints}">0</p>
            </div>
            <div class="card text-center p-6">
              <i class="fas fa-check-circle text-[var(--success)] text-2xl mb-2"></i>
              <h3 class="text-lg font-semibold">Resolved</h3>
              <p class="text-3xl font-bold text-[var(--success)] count-up" data-target="${resolvedComplaints}">0</p>
            </div>
          </div>
          <div class="flex flex-col sm:flex-row gap-4 mt-6">
            <button onclick="showPage('adminPage')" class="btn-primary flex-1">Manage Complaints</button>
            <button onclick="showPage('complaintTrackingPage')" class="btn-primary flex-1">Track Complaints</button>
          </div>
        `;
        document.querySelectorAll('.count-up').forEach(counter => {
          const target = parseInt(counter.getAttribute('data-target'));
          let current = 0;
          const increment = target / 50;
          const updateCounter = () => {
            current += increment;
            if (current < target) {
              counter.textContent = Math.ceil(current);
              requestAnimationFrame(updateCounter);
            } else {
              counter.textContent = target;
            }
          };
          updateCounter();
        });
      } else {
        const userComplaints = problems.filter(p => p.userType.toLowerCase() === currentUserRole);
        let complaintsHTML = userComplaints.length === 0 ? `
          <div class="text-center">
            <i class="fas fa-folder-open text-5xl text-[var(--text-secondary)] mb-4"></i>
            <p class="text-[var(--text-secondary)]">No complaints submitted yet.</p>
          </div>
        ` : `
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Complaint ID</th>
                  <th>Category</th>
                  <th>Description</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="dashboardTableBody">
                ${userComplaints.map((problem, index) => `
                  <tr>
                    <td>#${101 + index}</td>
                    <td>${problem.category}</td>
                    <td>${problem.description}</td>
                    <td style="color: ${problem.status === 'Resolved' ? 'var(--success)' : problem.status === 'Pending' ? 'var(--warning)' : 'var(--error)'}">${problem.status}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        `;
        dashboardContent.innerHTML = `
          <h3 class="text-lg font-semibold mb-4">Recent Complaints</h3>
          ${complaintsHTML}
          <div class="flex flex-col sm:flex-row gap-4 mt-6">
            <button onclick="showPage('complaintSubmissionPage')" class="btn-primary flex-1">Submit New Complaint</button>
            <button onclick="showPage('complaintTrackingPage')" class="btn-primary flex-1">Track Complaints</button>
          </div>
        `;
        gsap.from('#dashboardTableBody tr', { opacity: 0, x: -20, duration: 0.4, stagger: 0.1 });
      }
    }

    function submitComplaint() {
      const name = document.getElementById('complaint-name').value;
      const email = document.getElementById('complaint-email').value;
      const description = document.getElementById('complaint-description').value;
      const category = document.getElementById('complaint-category').value;

      if (name && email && description && category) {
        problems.push({
          userType: currentUserRole,
          name,
          email,
          category,
          description,
          status: 'Pending',
          assignedTo: null
        });
        saveComplaints();
        alert('Complaint submitted successfully!');
        sendEmailNotification(name, category);
        showPage('dashboardPage');
      } else {
        alert('Please fill in all fields.');
      }
    }

    function sendEmailNotification(name, category) {
      alert(`Email sent to admin: New complaint submitted by ${name}. Category: ${category}`);
    }

    function loadComplaints() {
      const complaintTableBody = document.getElementById('complaintTableBody');
      complaintTableBody.innerHTML = '';
      const filteredComplaints = currentUserRole === 'admin' ? problems : problems.filter(p => p.userType.toLowerCase() === currentUserRole);

      filteredComplaints.forEach((problem, index) => {
        complaintTableBody.innerHTML += `
          <tr>
            <td>#${101 + index}</td>
            <td>${problem.category}</td>
            <td>${problem.description}</td>
            <td style="color: ${problem.status === 'Resolved' ? 'var(--success)' : problem.status === 'Pending' ? 'var(--warning)' : 'var(--error)'}">${problem.status}</td>
            <td>${problem.status === 'Resolved' ? `<button onclick="showFeedbackPage(${index})" class="btn-secondary">Leave Feedback</button>` : ''}</td>
          </tr>
        `;
      });
      gsap.from('#complaintTableBody tr', { opacity: 0, x: -20, duration: 0.4, stagger: 0.1 });
    }

    function loadAdminComplaints() {
      const adminTableBody = document.getElementById('adminComplaintTableBody');
      adminTableBody.innerHTML = '';

      problems.forEach((problem, index) => {
        adminTableBody.innerHTML += `
          <tr>
            <td>#${101 + index}</td>
            <td>${problem.category}</td>
            <td>${problem.description}</td>
            <td>
              <select onchange="updateStatus(${index}, this.value)">
                <option value="Pending" ${problem.status === 'Pending' ? 'selected' : ''}>Pending</option>
                <option value="In Progress" ${problem.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                <option value="Resolved" ${problem.status === 'Resolved' ? 'selected' : ''}>Resolved</option>
              </select>
            </td>
            <td>
              <input type="text" id="assign-${index}" placeholder="Assign to" value="${problem.assignedTo || ''}" />
              <button onclick="assignComplaint(${index})" class="btn-primary mt-2">Assign</button>
            </td>
            <td>
              <button onclick="deleteComplaint(${index})" class="btn-danger">Delete</button>
            </td>
          </tr>
        `;
      });
      gsap.from('#adminComplaintTableBody tr', { opacity: 0, x: -20, duration: 0.4, stagger: 0.1 });
    }

    function updateStatus(index, status) {
      problems[index].status = status;
      saveComplaints();
      loadAdminComplaints();
    }

    function assignComplaint(index) {
      const assignedTo = document.getElementById(`assign-${index}`).value;
      problems[index].assignedTo = assignedTo;
      saveComplaints();
      loadAdminComplaints();
    }

    function deleteComplaint(index) {
      problems.splice(index, 1);
      saveComplaints();
      loadAdminComplaints();
    }

    function searchComplaints() {
      filterComplaints();
    }

    function filterComplaints() {
      const searchText = document.getElementById('searchInput').value.toLowerCase();
      const statusFilter = document.getElementById('status-filter').value;
      const filteredComplaints = problems.filter(problem => {
        const matchesSearch = problem.category.toLowerCase().includes(searchText) ||
          problem.description.toLowerCase().includes(searchText);
        const matchesStatus = statusFilter === 'all' || problem.status.toLowerCase() === statusFilter;
        const matchesUser = currentUserRole === 'admin' || problem.userType.toLowerCase() === currentUserRole;
        return matchesSearch && matchesStatus && matchesUser;
      });

      const complaintTableBody = document.getElementById('complaintTableBody');
      complaintTableBody.innerHTML = '';

      filteredComplaints.forEach((problem, index) => {
        complaintTableBody.innerHTML += `
          <tr>
            <td>#${101 + index}</td>
            <td>${problem.category}</td>
            <td>${problem.description}</td>
            <td style="color: ${problem.status === 'Resolved' ? 'var(--success)' : problem.status === 'Pending' ? 'var(--warning)' : 'var(--error)'}">${problem.status}</td>
            <td>${problem.status === 'Resolved' ? `<button onclick="showFeedbackPage(${index})" class="btn-secondary">Leave Feedback</button>` : ''}</td>
          </tr>
        `;
      });
      gsap.from('#complaintTableBody tr', { opacity: 0, x: -20, duration: 0.4, stagger: 0.1 });
    }

    function loadUserProfile() {
      if (currentUser) {
        document.getElementById('profile-name').value = currentUser.username || currentUser.id || '';
        document.getElementById('profile-email').value = currentUser.email || '';
        document.getElementById('profile-role').value = currentUserRole;
      }
    }

    function updateProfile() {
      const name = document.getElementById('profile-name').value;
      const email = document.getElementById('profile-email').value;
      if (name && email) {
        if (currentUserRole === 'student') {
          currentUser.username = name;
          currentUser.email = email;
        } else {
          currentUser.id = name;
        }
        alert('Profile updated successfully!');
      } else {
        alert('Please fill in all fields.');
      }
    }

    function showFeedbackPage(index) {
      currentFeedbackIndex = index;
      showPage('feedbackPage');
    }

    function loadFeedbackPage() {
      const details = document.getElementById('resolution-details');
      if (currentFeedbackIndex !== null) {
        const problem = problems[currentFeedbackIndex];
        details.innerHTML = `
          <p><strong>Complaint ID:</strong> #${101 + currentFeedbackIndex}</p>
          <p><strong>Issue:</strong> ${problem.category}</p>
          <p><strong>Resolution:</strong> The issue has been addressed by the assigned team.</p>
        `;
      }
    }

    function submitFeedback() {
      const feedback = document.getElementById('feedback-text').value;
      if (feedback) {
        alert('Feedback submitted successfully!');
        document.getElementById('feedback-text').value = '';
        showPage('dashboardPage');
      } else {
        alert('Please provide feedback.');
      }
    }

    function toggleFAQ(index) {
      const answer = document.getElementById(`answer-${index}`);
      answer.style.display = answer.style.display === 'block' ? 'none' : 'block';
      gsap.from(answer, { opacity: 0, height: 0, duration: 0.3 });
    }

    function searchFAQs() {
      const searchValue = document.getElementById('faq-search').value.toLowerCase();
      document.querySelectorAll('.faq-item').forEach(item => {
        const question = item.querySelector('.faq-question').textContent.toLowerCase();
        item.style.display = question.includes(searchValue) ? 'block' : 'none';
      });
    }

    document.getElementById('themeToggle').addEventListener('click', () => {
      document.body.dataset.theme = document.body.dataset.theme === 'dark' ? 'light' : 'dark';
      document.getElementById('themeToggle').innerHTML = document.body.dataset.theme === 'dark' ? '<i class="fas fa-sun"></i> Light Mode' : '<i class="fas fa-moon"></i> Dark Mode';
    });

    document.getElementById('menuToggle').addEventListener('click', () => {
      document.getElementById('sidebar').classList.toggle('sidebar-hidden');
    });

    function showNotifications() {
      alert('No new notifications.');
    }

    document.querySelectorAll('button').forEach(button => {
      button.addEventListener('mouseenter', () => gsap.to(button, { scale: 1.05, duration: 0.2 }));
      button.addEventListener('mouseleave', () => gsap.to(button, { scale: 1, duration: 0.2 }));
    });

    loadComplaintsFromStorage();
    showPage('loginPage');
  </script>
</body>
</html>